
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.2">
    
    
      
        <title>I/O and file systems - DiRAC Extreme Scaling User Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1118c9be.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ba0d045b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#io-and-file-systems" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DiRAC Extreme Scaling User Documentation" class="md-header__button md-logo" aria-label="DiRAC Extreme Scaling User Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DiRAC Extreme Scaling User Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              I/O and file systems
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/EPCCed/dirac-docs.git/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    EPCCed/dirac-docs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DiRAC Extreme Scaling User Documentation" class="md-nav__button md-logo" aria-label="DiRAC Extreme Scaling User Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    DiRAC Extreme Scaling User Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/EPCCed/dirac-docs.git/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    EPCCed/dirac-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Documentation overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Tesseract User Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tesseract User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Tesseract User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../tesseract-user-guide/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        Tursa User Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tursa User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tursa User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../connecting/" class="md-nav__link">
        Connecting to Tursa
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        Data Management and transfer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../sw-environment/" class="md-nav__link">
        Software environment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scheduler/" class="md-nav__link">
        Running jobs on Tursa
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#using-the-archer2-file-systems" class="md-nav__link">
    Using the ARCHER2 file systems
  </a>
  
    <nav class="md-nav" aria-label="Using the ARCHER2 file systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#home-file-systems" class="md-nav__link">
    Home file systems
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#work-file-system" class="md-nav__link">
    Work file system
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-io-patterns" class="md-nav__link">
    Common I/O patterns
  </a>
  
    <nav class="md-nav" aria-label="Common I/O patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-file-single-writer-serial-io" class="md-nav__link">
    Single file, single writer (Serial I/O)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-per-process-fpp" class="md-nav__link">
    File-per-process (FPP)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-file-multiple-writers-without-collective-operations" class="md-nav__link">
    Single file, multiple writers without collective operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-shared-file-with-collective-writes-ssf" class="md-nav__link">
    Single Shared File with collective writes (SSF)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#achieving-efficient-io" class="md-nav__link">
    Achieving efficient I/O
  </a>
  
    <nav class="md-nav" aria-label="Achieving efficient I/O">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lustre" class="md-nav__link">
    Lustre
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#striping" class="md-nav__link">
    Striping
  </a>
  
    <nav class="md-nav" aria-label="Striping">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-configuration" class="md-nav__link">
    Default configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-custom-striping-configurations" class="md-nav__link">
    Setting Custom Striping Configurations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recommended-archer2-io-settings" class="md-nav__link">
    Recommended ARCHER2 I/O settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#io-profiling" class="md-nav__link">
    I/O Profiling
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/EPCCed/dirac-docs.git/edit/main/docs/tursa-user-guide/io.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="io-and-file-systems">I/O and file systems</h1>
<h2 id="using-the-archer2-file-systems">Using the ARCHER2 file systems</h2>
<p>Different file systems are configured for different purposes and
performance. ARCHER2 has three file systems available to users:</p>
<table>
<thead>
<tr>
<th>Node type</th>
<th>Available file systems</th>
</tr>
</thead>
<tbody>
<tr>
<td>Login</td>
<td>/home, /work</td>
</tr>
<tr>
<td>Compute</td>
<td>/work</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Any data used in a parallel jobs should be located on <code>/work</code> (Lustre).</p>
</div>
<h3 id="home-file-systems">Home file systems</h3>
<p>Home directories provide a convenient means for a user to have access to
files such as source files, input files or configuration files. This
file system is only mounted on the login nodes. The home directory for
each user is located at:</p>
<pre><code>/home/[project code]/[group code]/[username]
</code></pre>
<p>where</p>
<ul>
<li><code>[project code]</code> is the code for your project (e.g., x01);</li>
<li><code>[group code]</code> is the code for your project group, if your project has
     groups, (e.g. x01-a) or the same as the project code, if not;</li>
<li><code>[username]</code> is your login name.</li>
</ul>
<p>Each project is allocated a portion of the total storage available, and
the project PI will be able to sub-divide this quota among the groups
and users within the project. As is standard practice on UNIX and Linux
systems, the environment variable <code>$HOME</code> is automatically set to point
to your home directory.</p>
<p>It should be noted that the home file system is not designed, and does
not have the capacity, to act as a long term archive for large sets of
results.</p>
<h3 id="work-file-system">Work file system</h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There is no backup of data on any of the work file systems,
which means that in the event of a major hardware failure, or if a user
accidently deletes essential data, it will not be possible to recover
the lost files.</p>
</div>
<p>A high-performance Lustre file system is mounted on the compute nodes. All
parallel calculations must be run from directories on the <code>/work</code> file
system and all files required by the calculation (apart from the
executable) must reside on <code>/work</code>. Each project will be assigned space
on a particular Lustre partition with the assignments chosen to balance
the load across the available infrastructure.</p>
<p>The work directory for each user is located at:</p>
<pre><code>/work/[project code]/[group code]/[username]
</code></pre>
<p>where</p>
<ul>
<li><code>[project code]</code> is the code for your project (e.g., x01);</li>
<li><code>[group code]</code> is the code for your project group, if your project has
     groups, (e.g. x01-a) or the same as the project code, if not;</li>
<li><code>[username]</code> is your login name.</li>
</ul>
<p>Links from the <code>/home</code> file system to directories or files on <code>/work</code>
are strongly discouraged. If links are used, executables and data files
on <code>/work</code> to be used by applications on the compute nodes (i.e. those
executed via the <code>aprun</code> command) should be referenced directly on
<code>/work</code>.</p>
<h2 id="common-io-patterns">Common I/O patterns</h2>
<p>There is a number of I/O patterns that are frequently used in
applications:</p>
<h3 id="single-file-single-writer-serial-io">Single file, single writer (Serial I/O)</h3>
<p>A common approach is to funnel all the I/O through a single master
process. Although this has the advantage of producing a single file, the
fact that only a single client is doing all the I/O means that it gains
little benefit from the parallel file system.</p>
<h3 id="file-per-process-fpp">File-per-process (FPP)</h3>
<p>One of the first parallel strategies people use for I/O is for each
parallel process to write to its own file. This is a simple scheme to
implement and understand but has the disadvantage that, at the end of
the calculation, the data is spread across many different files and may
therefore be difficult to use for further analysis without a data
reconstruction stage.</p>
<h3 id="single-file-multiple-writers-without-collective-operations">Single file, multiple writers without collective operations</h3>
<p>There are a number of ways to achieve this. For example, many processes
can open the same file but access different parts by skipping some
initial offset; parallel I/O libraries such as MPI-IO, HDF5 and NetCDF
also enable this.</p>
<p>Shared-file I/O has the advantage that all the data is organised
correctly in a single file making analysis or restart more
straightforward.</p>
<p>The problem is that, with many clients all accessing the same file,
there can be a lot of contention for file system resources.</p>
<h3 id="single-shared-file-with-collective-writes-ssf">Single Shared File with collective writes (SSF)</h3>
<p>The problem with having many clients performing I/O at the same time is
that, to prevent them clashing with each other, the I/O library may have
to take a conservative approach. For example, a file may be locked while
each client is accessing it which means that I/O is effectively
serialised and performance may be poor.</p>
<p>However, if I/O is done collectively where the library knows that all
clients are doing I/O at the same time, then reads and writes can be
explicitly coordinated to avoid clashes. It is only through collective
I/O that the full bandwidth of the file system can be realised while
accessing a single file.</p>
<h2 id="achieving-efficient-io">Achieving efficient I/O</h2>
<p>This section provides information on getting the best performance out of
the parallel <code>/work</code> file systems on ARCHER2 when writing data,
particularly using parallel I/O patterns.</p>
<h3 id="lustre">Lustre</h3>
<p>The ARCHER2 <code>/work</code> file systems use Lustre as a parallel file system
technology. The Lustre file system provides POSIX semantics (changes on
one node are immediately visible on other nodes) and can support very
high data rates for appropriate I/O patterns.</p>
<h3 id="striping">Striping</h3>
<p>One of the main factors leading to the high performance of Lustre file
systems is the ability to stripe data across multiple Object Storage
Targets (OSTs) in a round-robin fashion. Files are striped when the data
is split up in chunks that will then be stored on different OSTs across
the Lustre system. Striping might improve the I/O performance because it
increases the available bandwith since multiple processes can read and
write the same files simultaneously. However striping can also increase
the overhead. Choosing the right striping configuration is key to obtain
high performance results.</p>
<p>Users have control of a number of striping settings on Lustre file
systems. Although these parameters can be set on a per-file basis they
are usually set on directory where your output files will be written so
that all output files inherit the settings.</p>
<h4 id="default-configuration">Default configuration</h4>
<p>The <code>/work</code> file systems on ARCHER2 have the same default stripe
 settings:</p>
<ul>
<li>A default stripe count of 1</li>
<li>A default stripe size of 1 MiB (1048576 bytes)</li>
</ul>
<p>These settings have been chosen to provide a good compromise for the
wide variety of I/O patterns that are seen on the system but are
unlikely to be optimal for any one particular scenario. The Lustre
command to query the stripe settings for a directory (or file) is <code>lfs
getstripe</code>. For example, to query the stripe settings of an already
created directory <code>res_dir</code>:</p>
<pre><code>[auser@archer2]$ lfs getstripe res_dir/
res_dir
stripe_count:   1 stripe_size:    1048576 stripe_offset:  -1
</code></pre>
<h4 id="setting-custom-striping-configurations">Setting Custom Striping Configurations</h4>
<p>Users can set stripe settings for a directory (or file) using the
<code>lfs setstripe</code> command. The options for <code>lfs setstripe</code> are:</p>
<ul>
<li><code>[--stripe-count|-c]</code> to set the stripe count; 0 means use the
    system default (usually 1) and -1 means stripe over all available
    OSTs.</li>
<li><code>[--stripe-size|-s]</code> to set the stripe size; 0 means use the system
    default (usually 1 MB) otherwise use k, m or g for KB, MB or GB
    respectively</li>
<li><code>[--stripe-index|-i]</code> to set the OST index (starting at 0) on which
    to start striping for this file. An index of -1 allows the MDS to
    choose the starting index and it is strongly recommended, as this
    allows space and load balancing to be done by the MDS as needed.</li>
</ul>
<p>For example, to set a stripe size of 4 MiB for the existing directory
<code>res_dir</code>, along with maximum striping count you would use:</p>
<pre><code>[auser@archer2]$ lfs setstripe -s 4m -c -1 res_dir/
</code></pre>
<h3 id="recommended-archer2-io-settings">Recommended ARCHER2 I/O settings</h3>
<p>With the default settings, parallel I/O on multiple nodes can
currently give poor perfomance. We recommend always setting the
following environment variable in your SLURM batch script:</p>
<pre><code>export FI_OFI_RXM_SAR_LIMIT=64K
</code></pre>
<p>Although I/O requirements vary significantly between different
applications, the following settings should be good in most cases:</p>
<ul>
<li>
<p>If each process is writing to its own individual file then the default settings should give good performance.</p>
</li>
<li>
<p>If processes are writing to a single shared file (e.g. using
    MPI-IO, HDF5 or NetCDF), set the appropriate
    directories to be fully striped: <code>lfs setstripe -c -1 directory/</code></p>
</li>
</ul>
<h2 id="io-profiling">I/O Profiling</h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We will add advice on I/O profiling soon.</p>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.2b46852b.min.js"></script>
      
    
  </body>
</html>